version: "3.8"

 services:
  # ============================================
  # Development Service (Vite Dev Server)
  # ============================================
  dev:
    image: node:20-alpine
    container_name: dharma-maritime-dev
    working_dir: /app
    ports:
      - "3000:3000"
    volumes:
      # Mount entire project for hot module replacement
      - ./:/app
      - /app/node_modules
      - /app/.vite
    environment:
      - NODE_ENV=development
      - VITE_HOST=0.0.0.0
      - VITE_PORT=3000
    command: sh -c "npm install && npm run dev -- --host --port 3000"
    restart: unless-stopped
    networks:
      - dharma-maritime-network
    profiles:
      - dev

  # ============================================
  # Production Service (Nginx)
  # ============================================
  web:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NODE_ENV=production
    container_name: dharma-maritime-web
    ports:
      - "8080:80"
    volumes:
      # Mount build output in development (optional)
      - ./dist:/usr/share/nginx/html:ro
    environment:
      - NGINX_HOST=localhost
      - NGINX_PORT=80
    restart: unless-stopped
    networks:
      - dharma-maritime-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  dharma-maritime-network:
    name: dharma-maritime-network
    driver: bridge
